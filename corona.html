<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>corona api</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>
</head>
<body>
	<script>
		var url = 'http://openapi.data.go.kr/openapi/service/rest/Covid19/getCovid19InfStateJson'; /*URL*/
		var queryParams = '?' + encodeURIComponent('ServiceKey') + '='+'서비스키'; /*Service Key*/
		queryParams += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent('서비스키'); /**/
		queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
		queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /**/
		

		// fetch(url + queryParams)
		// .then( res => res.text() )
		// .then( xml => (new window.DOMParser()).parseFromString(xml, 'text/xml') )
		// .then( data => console.log(data) ) 

		let corona_data = []; //전역(global) 변수

		const getCoronaData = async () => {
			let corona_url = url + queryParams;
			let startDate = "20201001";
			let endDate = "20201020";
			corona_url += '&' + encodeURIComponent('startCreateDt') + '=' + encodeURIComponent(startDate);
			corona_url += '&' + encodeURIComponent('endCreateDt') + '=' + encodeURIComponent(endDate); 
			let response = await fetch(corona_url);
			let txt = await response.text();
			let xml = await (new window.DOMParser()).parseFromString(txt, 'text/xml');
			//console.log(xml);
			corona_data = await xml2json(xml);
			console.log(corona_data);
		}

		const xml2json = (xml) => {
			let data = {};
			let body = $(xml).find("body")[0];
			data.total = $(body).find("totalCount")[0].innerHTML;
			data.page = $(body).find("pageNo")[0].innerHTML;
			let items = $(body).find("item");
			data.items = [];
			for( let i=0; i<items.length; i++) {
				let item = {};
				item.date = $(items[i]).find("stateDt").text();
				item.time = $(items[i]).find("stateTime").text();
				item.case = $(items[i]).find("decideCnt").text();
				item.clear = $(items[i]).find("clearCnt").text();
				item.death = $(items[i]).find("deathCnt").text();
				item.care = $(items[i]).find("careCnt").text();
				data.items.push(item);
			}
			return data;
		}

		getCoronaData();


	</script>
</body>
</html>
